<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta charset="UTF-8">
		<link rel="stylesheet" href="css/wifinfo.css">
		<title>Wifinfo</title>
	</head>
	<body>
	  <div class="container">
			<!--  Onglets  -->
			<ul class="nav nav-tabs" id="myTab">
			 	<li class="active"><a href="#tab_tinfo" data-toggle="tab"><span class="glyphicon glyphicon-flash">&nbsp;</span>Téléinformation&nbsp;<span class="badge" id="scharge"></span></a></li>
			 	<li><a href="#tab_sys" data-toggle="tab"><span class="glyphicon glyphicon-cog">&nbsp;</span>Système</a></li>
			 	<li><a href="#tab_cfg" data-toggle="tab"><span class="glyphicon glyphicon-wrench">&nbsp;</span>Configuration</a></li>
			 	<li><a href="#tab_fs" data-toggle="tab"><span class="glyphicon glyphicon-folder-open">&nbsp;</span>Fichiers&nbsp;<span class="badge" id="sspiffs"></span></a></li>
			 	<li><a href="#tab_log" data-toggle="tab"><span class="glyphicon glyphicon-list-alt">&nbsp;</span>Événements&nbsp;<span class="badge" id="slogger"></span></a></li>
			</ul>

			<!-- Contenu des onglets -->
			<div class="tab-content">
	  
				<!-- tab teleinfo -->
		    <div class="tab-pane fade in active" id="tab_tinfo">
					<h4>Données de Téléinformation</h4>
					<div>
						<span style="float:left;width:18ex;text-align:center;">Charge courante : </span>
						<div class="progress">
							<div class="progress-bar progress-bar-success" style="width:0" id="pbar">
								<span class=show id="pcharge">Attente des données</span>
							</div>
						</div>
					</div>
					<div id="toolbar">
					</div>
					<table  data-toggle="table" 
									data-toolbar="#toolbar"
									class="table table-striped" 
									data-show-refresh="true" 
									data-show-toggle="true" 
									data-show-columns="true" 
									data-search="true" 
									data-row-style="rowStyle" 
									id="tab_tinfo_data" 
									data-select-item-name="toolbar1">
						<thead>
							<tr>
								<th data-field="na" data-align="left" data-sortable="true" data-formatter="labelFormatter">Etiquette</th>
								<th data-field="de" data-align="left">Description</th>
								<th data-field="va" data-align="left" data-sortable="true" data-formatter="valueFormatter">Valeur</th>
								<th data-field="ck" data-align="center" data-visible="false">Checksum</th>
								<th data-field="fl" data-align="center" data-visible="false">Flags</th>
							</tr>
						</thead>
					</table>
				</div> <!-- tab pane teleinfo -->

		  	<!-- tab Systeme -->
				<div class="tab-pane fade" id="tab_sys">
					<h4>Données du système</h4>
					<table 	data-toggle="table" 
									class="table table-striped table-condensed" 
									data-show-refresh="true" 
									data-show-toggle="true" 
									data-search="true" 
									id="tab_sys_data" 
									data-select-item-name="toolbar2">
						<thead>
							<tr>
								<th data-field="na" data-align="left">Donnée</th>
								<th data-field="va" data-align="left">Valeur</th>
								</tr>
						</thead>
					</table>
				</div> <!-- tab pane systeme-->

		  	<!-- tab evenements -->
				<div class="tab-pane fade" id="tab_log">
					<h4>Événements</h4>
					<table 	data-toggle="table" 
									class="table table-striped table-condensed" 
									data-show-refresh="true" 
									data-show-toggle="true" 
									data-search="true" 
									id="tab_log_data" 
									data-select-item-name="toolbar2">
						<thead>
							<tr>
								<th data-field="ev" data-align="left">Événement</th>
								</tr>
						</thead>
					</table>
				</div> <!-- tab pane journaux-->


				<!-- tab SPIFFS -->
				<div class="tab-pane fade" id="tab_fs">
					<h4>Fichiers du système</h4>
					<div>
						<span style="float:left;width:18ex;text-align:center;">Utilisation : </span>
						<div class="progress">
							<div class="progress-bar progress-bar-success" style="width:0" id="pfsbar">
								<span class=show id="fs_use">Calcul en cours</span>
							</div>
						</div>
					</div>
					
					<!-- SPIFFS upload file -->
					<div class="panel panel-info">
						<div class="panel-heading clearfix">
							<h3 class="panel-title">Chargement / Remplacement d'un fichier</h3>
						</div>
						<div class="panel-body">
							<div class="row">
								<form method='POST' id='frm_fs' action='/upload' enctype='multipart/form-data'>
								  <div class="col-xs-9">
										<div class="input-group">
											<span class="input-group-btn">
												<span class="btn btn-info btn-file">Selectionner&hellip; 
													<input id="file_fs" type="file" name="upload"></input>
												</span>
											</span>
											<input id="txt_upload_fs" type="text" size="32" class="form-control" placeholder="Aucun fichier sélectionné" readonly>
										</div>
									</div>
								  <div class="col-xs-3">
										<!--<input class="btn btn-danger hide" type="button" id="btn_upload_fs" onclick="Sendfile('fs');" value=""/>-->
										<input class="btn btn-danger hide" type="button" id="btn_upload_fs" value=""/>
								  </div>
								</form>
							</div>
							</p>
							<div id='pgfs' class='hide'>
								<span id='sfs' style="float:left;width:18ex;text-align:center;"></span>
								<div class="progress">
									<div class="progress-bar progress-bar-success" style="width:0" id="pfs">
										<span id="psfs"></span>
									</div>
								</div>
							</div>
						</div>
						<div class="panel-footer">
							<p id="fs_info"></p>
						</div>
					</div> 
					
					<!-- SPIFFS FS table -->
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">Système de fichiers SPIFFS</h3>
						</div>
						<div class="panel-body">
							<table 	data-toggle="table" 
											data-toolbar="#fs_toolbar"
											class="table table-striped table-condensed" 
											data-show-refresh="false" 
											data-show-columns="false" 
											data-search="false" 
											id="tab_fs_data" 
											data-select-item-name="toolbar4">
								<thead>
									<tr>
										<th data-field="na" data-align="left" data-formatter="fileFormatter">Fichier</th>
										<th data-field="va" data-align="center" data-sortable="true">taille (Octets)</th>
										<th data-field="act" data-align="left" data-formatter="deleteButtonMaker">Action</th>
									</tr>
								</thead>
							</table>
						</div>
					</div>
					
					<!-- SPIFFS FW/FS update -->
					
					<div class="panel panel-danger">
						<div class="panel-heading clearfix">
							<h3 class="panel-title">Mise à jour micro-logiciel ou serveur WEB embarqué</h3>
						</div>
						<div class="panel-body">
							<div class="row">
								<form method='POST' id='frm_fw' action='/update' enctype='multipart/form-data'>
								  <div class="col-xs-9">
										<div class="input-group">
											<span class="input-group-btn">
												<span class="btn btn-info btn-file">Selectionner&hellip; 
													<input id="file_fw" type="file" name="update"></input>
												</span>
											</span>
											<input id="txt_upload_fw" type="text" size="32" class="form-control" placeholder="Aucun fichier .cpp.bin ou .ino.bin ou .spiffs.bin choisi" readonly>
										</div>
									</div>
								  <div class="col-xs-3">
										<!--<input class="btn btn-danger hide" type="button" id="btn_upload_fw" onclick="Sendfile('fw');" value=""/>-->
										<input class="btn btn-danger hide" type="button" id="btn_upload_fw" value=""/>
								  </div>
								</form>
							</div>
							</p>
							<div id='pgfw' class='hide'>
								<span id='sfw' style="float:left;width:18ex;text-align:center;"></span>
								<div class="progress">
									<div class="progress-bar progress-bar-success" style="width:0" id="pfw">
										<span id="psfw"></span>
									</div>
								</div>
							</div>
						</div>
						<div class="panel-footer">
							<p id="fw_info"></p>
						</div>
					</div> 
				</div> <!-- tab pane SPIFFS-->

	 	  	<!-- tab Configuration -->
		    <div class="tab-pane fade" id="tab_cfg">
					<h4>Configuration du système</h4>
					<div>
						<form class="form-horizontal row-border" method="post" data-toggle="validator" id="frm_config" action="">
							<!-- Panel Config générale -->
							<div class="panel-group" id="pan_cfg">
								<div class="panel panel-primary">
									<input type="hidden" name="save" value="1">
									<div class="panel-heading clearfix">
										<h3 class="panel-title clickable" data-toggle="collapse" data-parent="#pan_cfg" data-target="#col_cfg">
											<span class="glyphicon glyphicon-wrench"></span>&nbsp;Générale<span class="pull-right glyphicon glyphicon-chevron-up"></span>
										</h3>
									</div>
			            <div class="panel-collapse collapse in" id="col_cfg">
									  <div class="panel-body">
											<div class="form-group">
												<label class="col-sm-3 control-label">Réseau Wifi</label>
												<div class="col-sm-9">
													<div class="input-group">
				 										<input type="text" class="form-control" id="ssid" name="ssid" maxlength="32" value="" placeholder="Nom de votre réseau Wifi">
														<div class="input-group-btn">
															<button class="btn btn-default dropdown-toggle" type="button" id="btn_scan" data-toggle="modal" data-target="#tab_scan">&nbsp;<span class="glyphicon glyphicon-zoom-in"></span></button>
													  </div>
													</div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">Clé Wifi</label>
												<div class="col-sm-9">
													<input type="password" class="form-control" id="psk" name="psk" maxlength="64" value="" placeholder="Clé de votre reseau Wifi">
												</div>
									    </div>
									    <div class="form-group">
												<label class="col-sm-3 control-label">Nom réseau</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="host" name="host" maxlength="32" value="" placeholder="Nom réseau du module WiInfo">
												</div>
									    </div>
									    <div class="form-group">
												<label class="col-sm-3 control-label">Tentatives de connexion (* 200ms)</label>
												<div class="col-sm-9">
													<input type="number" class="form-control" id="ap_retrycount" name="ap_retrycount" maxlength="32" value="" placeholder="Nombre de tentatives de connexion" onchange="document.getElementById('ap_retrycounts').value=(200*document.getElementById('ap_retrycount').value/1000) + ' seconde(s)'">
													<span class="help-block">Nombre de tentatives pour se connecter au Wifi spécifié. Chaque tentative dure 200ms</span>
													<input type="text" class="form-control" id="ap_retrycounts" readonly>
												</div>
									    </div>
									  </div> <!-- panel body-->
										<div class="panel-footer">
											<div class="text-center">
												<div class="btn-group">
													<button type="submit" class="btn btn-default btn-primary">Enregistrer</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div> <!-- panel config -->

							<!-- Panel Emoncms -->
							<div class="panel-group" id="pan_emon">
								<div class="panel panel-success">
									<div class="panel-heading clearfix">
										<h3 class="panel-title clickable" data-toggle="collapse" data-parent="#pan_emon" data-target="#col_emon">
											<span class="glyphicon glyphicon-leaf pull-left"></span>&nbsp;Emoncms<span class="pull-right glyphicon glyphicon-chevron-down"></span>
										</h3>
									</div>
			            <div class="panel-collapse collapse out" id="col_emon">
										<div class="panel-body">
										<!--
											<div class="form-group">
												<label class="col-sm-3 control-label">Protocole</label>
												<div class="col-sm-9">
													<input type="numeric" id="emon_port" name="emon_port" class="form-control col-sm-2">
														<option value="80">http (80)</option>
														<option value="443">https (443)</option>
													</select>
												</div>
											</div>
											-->
											<div class="form-group">
												<label class="col-sm-3 control-label">Port</label>
												<div class="col-sm-9">
													<input type="number" class="form-control" id="emon_port" name="emon_port" maxlength="4" placeholder="80 (http), 443 (https), ...">
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">Nom du serveur</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="emon_host" name="emon_host" maxlength="32" placeholder="Serveur">
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">URL</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="emon_url" name="emon_url" maxlength="32" placeholder="Url">
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">Clé API</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="emon_apikey" name="emon_apikey" maxlength="32" placeholder="API Key">
												</div>
											</div>

											<div class="form-group">
												<label class="col-sm-3 control-label">Mise à jour</label>
												<div class="col-sm-9">
													<select id="emon_port" name="emon_freq" class="form-control col-sm-2">
														<option value="0">désactivée</option>
														<option value="15">toutes les 15 secondes</option>
														<option value="30">toutes les 30 secondes</option>
														<option value="60">toutes les minutes</option>
														<option value="300">toutes les 5 minutes</option>
														<option value="900">tous les 1/4 d"heure</option>
														<option value="1800">toutes les 1/2 heure</option>
														<option value="3600">toutes les heures</option>
														<option value="21600">toutes les 6 heures</option>
														<option value="42300">toutes les 12 heures</option>
														<option value="86400">tous les jours</option>
													</select>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">Node ID</label>
												<div class="col-sm-9">
													<input type="number" class="form-control" id="emon_node" name="emon_node" size="3" min="0" max="254" placeholder="Node ID">
													<span class="help-block">Si à 0 alors pas de Node ID.</span>
												</div>
											</div>
										</div> 
										<div class="panel-footer">
											<div class="text-center">
												<div class="btn-group">
													<button type="submit" class="btn btn-default btn-success">Enregistrer</button>
												</div>
											</div>
										</div>
									</div>
								</div> 
							</div> <!-- panel emoncms -->


							<!-- Panel Jeedom -->
							<div class="panel-group" id="pan_jdom">
								<div class="panel panel-warning">
									<div class="panel-heading clearfix">
										<h3 class="panel-title clickable" data-toggle="collapse" data-parent="#pan_jdom" data-target="#col_jdom">
											<span class="glyphicon glyphicon-home"></span>&nbsp;Jeedom<span class="pull-right glyphicon glyphicon-chevron-down"></span>
										</h3>
									</div>
			            <div class="panel-collapse collapse out" id="col_jdom">
										<div class="panel-body">
										<!--
											<div class="form-group">
												<label class="col-sm-3 control-label">Protocole</label>
												<div class="col-sm-9">
													<select id="jdom_port" name="jdom_port" class="form-control col-sm-2">
														<option value="80">http (80)</option>
														<option value="443">https (443)</option>
													</select>
												</div>
											</div>
											-->
											<div class="form-group">
												<label class="col-sm-3 control-label">Port</label>
												<div class="col-sm-9">
													<input type="number" class="form-control" id="jdom_port" name="jdom_port" maxlength="4" placeholder="80 (http), 443 (https), ...">
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">Serveur Jeedom</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="jdom_host" name="jdom_host" maxlength="32" placeholder="Serveur">
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">URL</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="jdom_url" name="jdom_url" maxlength="64" placeholder="Url">
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">Clé API</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="jdom_apikey" name="jdom_apikey" maxlength="48" placeholder="API Key">
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">Mise à jour</label>
												<div class="col-sm-9">
													<select id="jdom_freq" name="jdom_freq" class="form-control col-sm-2">
														<option value="0">désactivée</option>
														<option value="15">toutes les 15 secondes</option>
														<option value="30">toutes les 30 secondes</option>
														<option value="60">toutes les minutes</option>
														<option value="300">toutes les 5 minutes</option>
														<option value="900">tous les 1/4 d"heure</option>
														<option value="1800">toutes les 1/2 heure</option>
														<option value="3600">toutes les heures</option>
														<option value="21600">toutes les 6 heures</option>
														<option value="42300">toutes les 12 heures</option>
														<option value="86400">tous les jours</option>
													</select>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">Identifiant compteur</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="jdom_adco" name="jdom_adco" maxlength="12" placeholder="ADCO Compteur">
													<span class="help-block">Uniquement si vous souhaitez forcer un autre identifiant que celui de votre compteur.</span>
												</div>
											</div>
										</div>
										<div class="panel-footer">
											<div class="text-center">
												<div class="btn-group">
													<button type="submit" class="btn btn-default btn-warning">Enregistrer</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div> <!-- panel Jeedom -->

							<!-- Panel Domoticz -->
							<div class="panel-group" id="pan_domoticz">
								<div class="panel panel-info">
									<div class="panel-heading clearfix">
										<h3 class="panel-title clickable" data-toggle="collapse" data-parent="#pan_domoticz" data-target="#col_domoticz">
											<span class="glyphicon glyphicon-equalizer"></span>&nbsp;Domoticz<span class="pull-right glyphicon glyphicon-chevron-down"></span>
										</h3>
									</div>
			            <div class="panel-collapse collapse out" id="col_domoticz">
										<div class="panel-body">
										<!--
											<div class="form-group">
												<label class="col-sm-3 control-label">Protocole</label>
												<div class="col-sm-9">
													<select id="dmcz_port" name="dmcz_port" class="form-control col-sm-2">
														<option value="80">http (80)</option>
														<option value="443">https (443)</option>
													</select>
												</div>
											</div>
											-->
											<div class="form-group">
												<label class="col-sm-3 control-label">Port</label>
												<div class="col-sm-9">
													<input type="number" class="form-control" id="dmcz_port" name="dmcz_port" maxlength="4" placeholder="80 (http), 443 (https), ...">
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">Serveur Domoticz</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="dmcz_host" name="dmcz_host" maxlength="32" placeholder="Serveur">
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">URL</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="dmcz_url" name="dmcz_url" maxlength="64" placeholder="Url">
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">Basic Auth</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="dmcz_usr" name="dmcz_usr" maxlength="32" placeholder="User"></br>
													<input type="password" class="form-control" id="dmcz_pwd" name="dmcz_pwd" maxlength="32" placeholder="Password">													
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">Mise à jour</label>
												<div class="col-sm-9">
													<select id="domoticz_freq" name="dmcz_freq" class="form-control col-sm-2">
														<option value="0">désactivée</option>
														<option value="15">toutes les 15 secondes</option>
														<option value="30">toutes les 30 secondes</option>
														<option value="60">toutes les minutes</option>
														<option value="300">toutes les 5 minutes</option>
														<option value="900">tous les 1/4 d"heure</option>
														<option value="1800">toutes les 1/2 heure</option>
														<option value="3600">toutes les heures</option>
														<option value="21600">toutes les 6 heures</option>
														<option value="42300">toutes les 12 heures</option>
														<option value="86400">tous les jours</option>
													</select>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label">Identifiants dispositifs Domoticz</label>
												<div class="col-sm-9">
													<input type="number" class="form-control" id="dmcz_idx_txt" name="dmcz_idx_txt" maxlength="3" placeholder="ADCO">
													<span class="help-block">IDX Domoticz pour mise à jour d'un dispositif General - Text (ADCO)</span>
													<input type="number" class="form-control" id="dmcz_idx_p1sm" name="dmcz_idx_p1sm" maxlength="3" placeholder="P1 Smart Meter">
													<span class="help-block">IDX Domoticz pour mise à jour d'un dispositif P1 Smart Meter - Energy (BASE,0,0,0,PAPP,0)</span>
													<input type="number" class="form-control" id="dmcz_idx_crt" name="dmcz_idx_crt" maxlength="3" placeholder="Current">
													<span class="help-block">IDX Domoticz pour mise à jour d'un dispositif General - Current (IINST)</span>
													<input type="number" class="form-control" id="dmcz_idx_elec" name="dmcz_idx_elec" maxlength="3" placeholder="Electric">
													<span class="help-block">IDX Domoticz pour mise à jour d'un dispositif Usage - Electric (PAPP)</span>
													<input type="number" class="form-control" id="dmcz_idx_kwh" name="dmcz_idx_kwh" maxlength="3" placeholder="Kwh">
													<span class="help-block">IDX Domoticz pour mise à jour d'un dispositif General (Calculé) - kWh (PAPP,0)</span>
													<input type="number" class="form-control" id="dmcz_idx_pct" name="dmcz_idx_pct" maxlength="3" placeholder="Percentage">
													<span class="help-block">IDX Domoticz pour mise à jour d'un dispositif General - Percentage (IINST/ISOUSC * 100)</span>
												</div>
											</div>
										</div>
										<div class="panel-footer">
											<div class="text-center">
												<div class="btn-group">
													<button type="submit" class="btn btn-default btn-info">Enregistrer</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div> <!-- panel Domoticz -->
							
							<!-- Reseau statique -->
							<!--
							<div class="panel panel-info">
								<div class="panel-heading clearfix">
									<h3 class="panel-title">Configuration WifInfo en Réseau statique</h3>
								</div>
								<div class="panel-body">
									<div class="form-group">
										<label class="col-sm-3 control-label">Adresse IP</label>
										<div class="col-sm-9">
											<input class="form-control" type="text" pattern="\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}" id="wifi_ip" name="wifi_ip">
										</div>
									</div>

									<div class="form-group">
										<label class="col-sm-3 control-label">Passerelle</label>
										<div class="col-sm-9">
											<input class="form-control" type="text" pattern="\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}" id="wifi_gw" name="wifi_gw">
										</div>
									</div>

									<div class="form-group">
										<label class="col-sm-3 control-label">Masque</label>
										<div class="col-sm-9">
											<input class="form-control" id="wifi_msk" type="text" pattern="\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}" id="wifi_msk" name="wifi_msk">
											<div class="help-block with-errors"></div> 
				      				<span class="help-block">Laisser ces 3 champs vides si vous êtes en configuration DHCP.</span>
										</div>
		      				</div>
									<div class="text-center">
										<div class="btn-group">
											<button type="submit" class="btn btn-default">Enregistrer</button>
										</div>
									</div>
								</div>
							</div>--> <!-- panel Reseau statique -->
							
							<!-- Advanced -->
							<div class="panel-group" id="pan_advanced">
								<div class="panel panel-danger">
									<div class="panel-heading">
										<h3 class="panel-title clickable" data-toggle="collapse" data-parent="#pan_advanced" data-target="#col_advanced">
											<span class="glyphicon glyphicon-cog"></span>&nbsp;Avancée<span class="pull-right glyphicon glyphicon-chevron-down"></span>
										</h3>
									</div>
				          <div class="panel-collapse collapse out" id="col_advanced">
										<div class="panel-body">
									    <div class="form-group">
												<label class="col-sm-3 control-label">Clé en mode AP</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="ap_psk" name="ap_psk" maxlength="64" value="" placeholder="Laisser vide pour un point d'accès ouvert">
												</div>
									    </div>

											<div class="form-group">
												<label class="col-sm-3 control-label">Mot de passe OTA</label>
												<div class="col-sm-9">
													<input type="text" class="form-control" id="ota_auth" name="ota_auth" placeholder="Mot de passe OTA">
													<span class="help-block">Laisser vide pour désactiver l"authentification par mot de passe pour les mise à jour.</span>
												</div>
											</div>

											<div class="form-group">
												<label class="col-sm-3 control-label">OTA Port</label>
												<div class="col-sm-9">
													<input type="number" class="form-control" id="ota_port" name="ota_port" size="5" min="1024" max="65534" placeholder="Port OTA">
												</div>
											</div>

											<div class="form-group">
												<label class="col-sm-3 control-label">Options</label>
												<div class="col-sm-9">
													<label class="checkbox-inline"><input type="checkbox" id="cfg_debug" name="cfg_debug" value="">Debug (Serial)</label>
													<label class="checkbox-inline"><input type="checkbox" id="cfg_info" name="cfg_info" value="">Info (Serial & FS)</label>
													<label class="checkbox-inline"><input type="checkbox" id="cfg_rgb" name="cfg_rgb" value="">LED RGB</label>
													<label class="checkbox-inline"><input type="checkbox" id="cfg_oled" name="cfg_oled" value="">Affichage Ecran OLED</label>
												</div>
											</div>
										</div>

										<div class="panel-footer">
											<div class="text-center">
												<div class="btn-group">
													<button class="btn btn-danger" id="btn_reboot">Redémarrer WiFinfo</button>
												</div>
												<div class="btn-group">
													<button class="btn btn-danger" data-toggle="modal" data-target="#confirm-raz">RAZ Usine</button>
												</div>
												<div class="btn-group">
													<button type="submit" class="btn btn-default btn-success">Enregistrer</button>
												</div>
											</div>
										</div>
									</div> 
								</div> 
							</div> <!-- advanced -->
						</form> <!-- config form -->
					</div> 
		  	</div> <!-- tab config-->

	  	</div> <!-- tab content-->

			<!-- Modal Confirm -->
			<div class="modal fade" id="confirm-raz" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
							<h4 class="modal-title" id="myModalLabel">Confirmez la Remise à Zéro</h4>
						</div>
						<div class="modal-body">
							<p>Vous allez effectuer un remise à zéro du module WifIno, cette procédure est irreversible et vous allez très certainement perdre votre connexion courante.</p>
							<p>Tout le système de fichiers va être vidé et vous allez devoir recharger tous les fichiers nécessaires au bon fonction.</p>
							<p>Voulez-vous vraiment continuer?</p>
							<p class="debug-url"></p>
						</div>

						<div class="modal-footer">
							<button type="button" class="btn btn-primary" data-dismiss="modal">Annuler</button>
							<button type="button" class="btn btn-danger" data-dismiss="modal" id="btn_reset">Oui tout effacer</button>
						</div>
					</div>
				</div>
			</div> <!-- Modal Confirm -->

			<!-- Modal Wifi Scan -->
			<div class="modal fade" id="tab_scan" tabindex="-1" role="dialog" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title">Liste des réseaux Wifi</h4>
						</div>
						<div class="modal-body">
							<table 	id="tab_scan_data" 
											class="table" 
											data-toggle="table" 
											data-cache="false" 
											data-sort-name="rssi" 
											data-sort-order="desc" 
											data-show-refresh="true" 
											data-show-loading="true">
								<thead>
									<tr>
										<th class="col-sm-5" data-field="ssid" data-sortable="true">SSID</th>
										<th class="col-sm-4" data-field="signal" data-align="center" data-formatter="RSSIFormatter">Qualité</th>
										<th class="col-sm-3" data-field="rssi" data-sortable="true" data-sort-order="asc" data-align="center">RSSI (dBm)</th>
									</tr>
								</thead>
							</table>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-error" data-dismiss="modal">Annuler</button>
						</div>
			   	</div> 
			 	</div> 
			</div> <!-- modal Wifi Scan -->

			<!-- Modal Reboot -->
			<div class="modal fade" id="mdl_wait" data-keyboard="false">
			  <div class="modal-dialog">
			    <div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title">Redémarrage WifInfo en cours</h4>
						</div>
						<div class="modal-body">
							<p class="text-center" id="txt_srv"></p>
							<p class="text-center">
								<span class="glyphicon glyphicon-refresh glyphicon-refresh-animate" style="font-size: 3.5em;">
								</span>
							</p>
							<p class="text-center" id="txt_elapsed"></p>
						</div>
					</div>
				</div>
			</div> <!-- Modal Reboot -->

			<!-- Modal Confirm Delete -->
			<div class="modal fade" id="confirm-del" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
							<h4 class="modal-title" id="myModalLabel">Confirmez la Suppression</h4>
						</div>
						<div class="modal-body">
							<p>Vous allez supprimer le fichier <span id="file2delete"></span>, cette procédure est irreversible.</p>
							<p>Si ce fichier est nécessaire au bon fonctionnement du système, vous devrez re-flasher le système.</p>
							<p>Voulez-vous vraiment continuer?</p>
							<p class="debug-url"></p>
						</div>

						<div class="modal-footer">
							<button type="button" class="btn btn-primary" data-dismiss="modal">Annuler</button>
							<button type="button" class="btn btn-danger" data-dismiss="modal" id="btn_delete" file2delete="" >Oui, le supprimer</button>
						</div>
					</div>
				</div>
			</div> <!-- Modal Confirm Delete-->

		<!--<button type="button" class="btn btn-danger" id="btn_test">test</button>-->
	  </div> <!-- Container -->

	  <!-- Scripts devant être chargés en fin de page -->
		<script src="js/wifinfo.js"></script>

		<script>  
			var Timer_sys;  
			var Timer_tinfo;  
			var counters={};
			var isousc, iinst;
			var elapsed = 0;

			function formatSize(bytes) {
			  if (bytes < 1024)  return bytes+' Bytes';
			  if (bytes < (1024*1024)) return (bytes/1024).toFixed(0)+' KB';
			  if (bytes < (1024*1024*1024)) return (bytes/1024/1024).toFixed(0)+' MB';
			  return (bytes/1024/1024/1024).toFixed(0)+' GB';
		  }

			function rowStyle(row, index) {  
				//var classes=['active','success','info','warning','danger'];  
				var flags=parseInt(row.fl,10);  
				//if (flags & 0x80) return {classes:classes[4]};
				//if (flags & 0x02) return {classes:classes[3]};
				//if (flags & 0x08) return {classes:classes[1]};
				if (flags & 0x80) return {classes:'danger'};
				if (flags & 0x02) return {classes:'warning'};
				if (flags & 0x08) return {classes:'success'};
				return {}; 
			} 

			function labelFormatter(value, row) {  
				var flags=parseInt(row.fl,10);  
				
				if ( typeof counters[value]==='undefined') 
					counters[value]=1;  
				if ( flags & 0x88 ) 
					counters[value]++;  
				return value + ' <span class=\"badge\">'+counters[value]+'</span>';   
				}  

			function valueFormatter(value, row) {  
				if (row.na=="ISOUSC")  
					isousc=parseInt(value);  
				else if (row.na=="IINST") {  
					var pb, pe, cl;  
					iinst=parseInt(value);  
					pe=parseInt(iinst*100/isousc);  
					if (isNaN(pe)) 
						pe=0;  
					cl='success';  
					if (pe>70) cl ='info';  
					if (pe>80) cl ='warning';  
					if (pe>90) cl ='danger';  

					cl = 'progress-bar-' + cl;  
					if (pe>0) 
						$('#scharge').text(pe+'%');  
					if (typeof isousc!='undefined')  
						$('#pcharge').text(iinst+'A / '+isousc+'A');  
					$('#pbar').attr('class','progress-bar '+cl);  
					$('#pbar').css('width', pe+'%');
				}   
				return value;         
			}  

			function deleteButtonMaker(value, row) {
				var htm = '';
				
				//htm += '<a href="#" class="confirm-delete btn mini red-stripe" role="button">'
				htm += '<button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#confirm-del" data-file2delete="' + row.na + '" >';
				htm += 'Supprimer';
				//htm += '</a>';
				htm += '</button>';
				
				return htm;
			}

			function fileFormatter(value, row) {  
				var fname = row.na;
				var htm = '';  

				//ht+= '<button type="button" class="btn btn-xs btn-danger" title="Supprimer">';
				//ht+= '<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;';
				//ht+= '</button>&nbsp;';
				//ht+= '<button type="button" class="btn btn-xs btn-primary" title="Télécharger">';
				//ht+= '<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;';
				//ht+= '</button>&nbsp;';
				htm+= '<a href="' + fname + '">' + fname + '</a>';

				return htm;
			}  

			function RSSIFormatter(value, row) {  
				var rssi=parseInt(row.rssi);  
				var signal = Math.min(Math.max(2*(rssi+100),0),100);
				var cl, htm;  
				cl='success';  
				if (signal<70) cl ='info';  
				if (signal<50) cl ='warning';  
				if (signal<30) cl ='danger';  

				cl = 'progress-bar-' + cl;  
				htm = "<div class='progress progress-tbl'>";
				htm+= "<div class='progress-bar "+cl+"' role='progressbar' aria-valuemin='0' aria-valuemax='100' ";
				htm+= "aria-valuenow='"+signal+"' style='width:"+signal+"%'>"+rssi+"dB</div></div>";
				return htm;
			}  

			function Notify(mydelay, myicon, mytype, mytitle, mymsg) {  
				$.notify(
					{	icon:'glyphicon glyphicon-'+myicon,
						title:'&nbsp;<strong>'+mytitle+'</strong>',
						message:'<p>'+mymsg+'</p>',
					},{
						type:mytype,
						//showProgressbar: true,
						animate:{enter:'animated fadeInDown',exit:'animated fadeOutUp',delay:mydelay*1000}
					}
				);
			}  

			function progressUpdate(data) {
			  if(data.lengthComputable) {
			  	var pe = (data.loaded/data.total*100).toFixed(0) ;
			  	$('#pfw').css('width', pe +'%');
			   	$('#psfw').text(formatSize(data.loaded)+' / '+formatSize(data.total));  
			  }
			}

			function progressUpload(data) {
			  if(data.lengthComputable) {
			  	var pe = (data.loaded/data.total*100).toFixed(0) ;
			  	$('#pfs').css('width', pe +'%');
			   	$('#psfs').text(formatSize(data.loaded)+' / '+formatSize(data.total));  
			  }
			}

			function waitReboot() {
   			var url = location.protocol+'//'+location.hostname+(location.port ? ':'+location.port: '') + '/#tab_sys' ;
				$('#txt_srv').text('Tentative de connexion à '+url);
				$('#mdl_wait').modal();

				var thistimer=setInterval(function() {
			    $.ajax({
			      cache: false,
			      type: 'GET',
			      url: '/hb.htm',
			      timeout: 900,
			      success: function(data, textStatus, XMLHttpRequest) {
			      	console.log(data);
			        if (data === 'OK') {
			  				$('#mdl_wait').modal('hide');	
			  				clearInterval(thistimer);
			  				window.location = url;
			  				location.reload();
		  					elapsed=0;
			        }
			      }
			    });
					elapsed++;
					$('#txt_elapsed').text('Temps écoulé ' + elapsed + ' s');
				}
				,1000);  
			}

			var remainingspace=0;
			function refreshFsTab() {
			$.getJSON( "/spiffs.json", function(spiffs_data) { 
						var pb, pe, cl;  		
						total= spiffs_data.spiffs[0].Total; 
						used = spiffs_data.spiffs[0].Used; 
						freeram = spiffs_data.spiffs[0].Ram; 
						remainingspace = total - used;

						//$('#tab_fs_data').bootstrapTable({silent:true, showLoading:true});
						$('#tab_fs_data').bootstrapTable('load', spiffs_data.files, {silent:true, showLoading:true});  

						pe=parseInt(used*100/total);  
						if (isNaN(pe)) 
							pe=0;  
						cl='success';  
						if (pe>70) cl ='warning';  
						if (pe>85) cl ='danger';  

						cl = 'progress-bar-' + cl;  
						if (pe>0) 
							$('#sspiffs').text(pe+'%');  
						$('#fs_use').text(formatSize(used)+' / '+formatSize(total));  
						$('#pfsbar').attr('class','progress-bar '+cl);  
						$('#pfsbar').css('width', pe+'%');

					})
					.fail(function() { console.log( "error while requestiong spiffs data" );	})
			}

			$('a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {  
				clearTimeout(Timer_sys);  
				clearTimeout(Timer_tinfo);  
				var target = $(e.target).attr("href")  
				console.log('activated ' + target );  

		    // IE10, Firefox, Chrome, etc.
				if (history.pushState) 
			    window.history.pushState(null, null, target);
				else 
			    window.location.hash = target;

				if (target=='#tab_tinfo')  {
					$('#tab_tinfo_data').bootstrapTable('refresh',{silent:true, url:'/tinfo.json'});  
				} else if (target=='#tab_sys') {
					$('#tab_sys_data').bootstrapTable('refresh',{silent:true, url:'/system.json'});  
				} else if (target=='#tab_log') {
					$('#tab_log_data').bootstrapTable('refresh',{silent:true, url:'/log.json'});  
				} else if (target=='#tab_fs') {
					refreshFsTab();
				} else if (target=='#tab_cfg') {
					$.getJSON( "/config.json", function(form_data) { 
						$("#frm_config").autofill(form_data);
						document.getElementById('ap_retrycount').onchange();
						})
						.fail(function() { console.log( "error while requestiong configuration data" );	})

					$('#tab_scan_data').bootstrapTable('refresh',{silent:true, showLoading:true, url:'/wifiscan.json'});  
				}
			});  

			$('#tab_tinfo_data').on('load-success.bs.table', function (e, data) {  
				console.log('#tab_tinfo_data loaded');  
		 		if ($('.nav-tabs .active > a').attr('href')=='#tab_tinfo')  
		  		Timer_tinfo=setTimeout(function(){$('#tab_tinfo_data').bootstrapTable('refresh',{silent: true})},1000);  
			}); 
			$('#tab_sys_data').on('load-success.bs.table', function (e, data) {  
				console.log('#tab_sys_data loaded');  
		 		if ($('.nav-tabs .active > a').attr('href')=='#tab_sys')  
		  		Timer_sys=setTimeout(function(){$('#tab_sys_data').bootstrapTable('refresh',{silent: true})},1000);  
			})
			$('#tab_log_data').on('load-success.bs.table', function (e, data) {  
				console.log('#tab_log_data loaded');  
		 		if ($('.nav-tabs .active > a').attr('href')=='#tab_log')  
		  		Timer_sys=setTimeout(function(){$('#tab_log_data').bootstrapTable('refresh',{silent: true})},1000);  
			})
			$('#tab_fs_data').on('load-success.bs.table', function (e, data) {  
				console.log('#tab_fs_data loaded');  
			})
			.on('load-error.bs.table', function (e, status) {  
				console.log('Event: load-error.bs.table');  
					// myTimer=setInterval(function(){myRefresh()},5000);  
			});  

			$('#tab_scan').on('click-row.bs.table', function (e, name, args) {  
				var $form = $('#tab_cfg');  
				$('#ssid').val(name.ssid);  
				setTimeout(function(){$('#psk').focus()},500);  
				$('#tab_scan').modal('hide');  
			});  
			$('#btn_scan').click(function () {  
				$('#tab_scan_data').bootstrapTable('refresh',{url:'/wifiscan.json',showLoading:false,silent:true});  
  		});  

			$('#confirm-del').on('show.bs.modal', function (event) {
			  var button = $(event.relatedTarget) // Button that triggered the modal
  			  var file2delete = button.data('file2delete') // Extract info from data-* attributes
			  var modal = $(this)
			  modal.find('#file2delete').text(file2delete)
			  modal.find('#btn_delete').attr("file2delete",file2delete)
			});
  		
  		 $('#btn_delete').click(function () {
    		var $btn = $(this).button('...');
    		$.post('/spiffs', { action: "delete", file : $btn.attr("file2delete")},
    					function(msg, textStatus, xhr) { 
  						Notify(2, 'ok', 'success', 'Suppression effectuée', xhr.status+' '+msg);
						},
						function(xhr, textStatus, errorThrown) {
  						Notify(4, 'remove', 'danger', 'Erreur lors de la suppression', xhr.status+' '+errorThrown);
 						});
    		refreshFsTab();
  			});
  		
			$('#btn_reset').click(function () {  
				$.post('/factory_reset');  
			  waitReboot(); 
			  return false;
			});  
			$('#btn_reboot').click(function () {  
			  $.post('/reset'); 
			  waitReboot(); 
			  return false;
			});  

			$(document)
				.on('change', '.btn-file :file', function() {
				  var input = $(this),
	      	numFiles = input.get(0).files ? input.get(0).files.length : 1,
	      	label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
	  			input.trigger('fileselect', [numFiles, label]);
				})
		    .on('show.bs.collapse', '.panel-collapse', function () {
		        var $span = $(this).parents('.panel').find('span.pull-right.glyphicon');
		        $span.removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
		    })
		    .on('hide.bs.collapse', '.panel-collapse', function () {
		        var $span = $(this).parents('.panel').find('span.pull-right.glyphicon');
		        $span.removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
		    })
		  ;

			$('#frm_config').validator().on('submit', function (e) {
				// everything looks good!
				if (!e.isDefaultPrevented()) {
					e.preventDefault();
					console.log("Form Submit");

					$.post('/config_form.json', $("#frm_config").serialize())
						.done( function(msg, textStatus, xhr) { 
  						Notify(2, 'ok', 'success', 'Enregistrement effectué', xhr.status+' '+msg);
						})
						.fail( function(xhr, textStatus, errorThrown) {
  						Notify(4, 'remove', 'danger', 'Erreur lors de l\'enregistrement', xhr.status+' '+errorThrown);
 						}
   				);
				}
			});

			$('#file_fs').change(function() {
				var $txt = $('#txt_upload_fs');
				var $btn = $('#btn_upload_fs');
				var ok = true;
				var f = this.files[0];
				var name = f.name.toLowerCase();
				var size = f.size;
				var type = f.type;
				var html = 'Fichier:' + name + '&nbsp;&nbsp;type:' + type + '&nbsp;&nbsp;taille:' + size + ' octets'
				console.log('name='+name);
				console.log('size'+size);
				console.log('type='+type);

				$('#pgfs').removeClass('show').addClass('hide');
				$('#sfs').text( name + ' : ');  

				if (f.size > remainingspace) {
					Notify(3, 'remove', 'danger', 'Taille du fichier', 'Le fichier est trop important par rapport à l\'espace disponible');
					ok = false;
				}
				
				if (ok) {
					$btn.removeClass('hide');
					label = 'Charger le fichier';
					$btn.val(label);
					$('#fs_info').html('<strong>' + label + '</strong> ' + html);
				} else {
					$txt.attr('readonly', '');
					$txt.val('');
					$txt.attr('readonly', 'readonly');
					$btn.addClass('hide');
				}
				return ok;
			});

			$('#btn_upload_fs').click(function() {
			var $txt = $('#txt_upload_fs');
			var $btn = $('#btn_upload_fs');
		    var formData = new FormData($('#frm_fs')[0]);
		    $.ajax({
	        url: '/upload',  
	        type: 'POST',
	        data: formData,
	        cache: false,
	        contentType: false,
	        processData: false,
	        xhr: function() {  
            var myXhr = $.ajaxSettings.xhr();
            if(myXhr.upload)
              myXhr.upload.addEventListener('progress',progressUpload, false); 
            return myXhr;
	        },
	        beforeSend: function () { 
 						$('#pgfs').removeClass('hide');
	        },
					success: function(msg, textStatus, xhr) {	
						Notify(2, 'floppy-saved', 'success','Envoi du fichier terminé', '<strong>'+xhr.status+'</strong> '+msg); 
						refreshFsTab();
						$txt.attr('readonly', '');
						$txt.val('');
						$txt.attr('readonly', 'readonly');
						$btn.addClass('hide');
						$('#pgfs').removeClass('show').addClass('hide');
						$('#sfs').text('');
						$('#fs_info').html('');
						$('#frm_fs')[0].reset();
					},
					error: function(xhr, textStatus, errorThrown) {
 						$('#pfs').removeClass('progress-bar-success').addClass('progress-bar-danger');
						Notify(4, 'floppy-remove', 'danger', 'Erreur lors de l\'envoi du fichier '+name,'<strong>'+xhr.status+'</strong> '+errorThrown);
					}
		    });
			});

			$('#file_fw').change(function() {
				var $txt = $('#txt_upload_fw');
				var $btn = $('#btn_upload_fw');
				var ok = true;
				var f = this.files[0];
				var name = f.name.toLowerCase();
				var size = f.size;
				var type = f.type;
				var html = 'Fichier:' + name + '&nbsp;&nbsp;type:' + type + '&nbsp;&nbsp;taille:' + size + ' octets'
				console.log('name='+name);
				console.log('size'+size);
				console.log('type='+type);

				$('#pgfw').removeClass('show').addClass('hide');
				$('#sfw').text( name + ' : ');  

				if (!f.type.match('application/octet-stream') && !f.type.match('application/macbinary')) {
					Notify(3, 'remove', 'danger', 'Type de fichier non conforme', 'Le fichier de mise à jour doit être un fichier binaire');
					ok = false;
				} else if (name!="wifinfo.cpp.bin" && name!="wifinfo.ino.bin" && name!="wifinfo.spiffs.bin") {
					Notify(5, 'remove', 'danger', 'Nom de fichier incorrect', 'Le fichier de mise à jour doit être nommé <ul><li>wifinfo.cpp.bin / wifinfo.ino.cpp (Micro-logiciel) ou</li><li>wifinfo.spiffs.bin (Système de fichiers)</li></ul>');
					ok = false;
				}
				if (ok) {
					$btn.removeClass('hide');
					if ( name==="wifinfo.cpp.bin" || name==="wifinfo.ino.bin") {
						label = 'Mise à jour Micro-Logiciel';
					}	else {
						label = 'Mise à jour SPIFFS';
					}
					$btn.val(label);
					$('#fw_info').html('<strong>' + label + '</strong> ' + html);
				} else {
					$txt.attr('readonly', '');
					$txt.val('');
					$txt.attr('readonly', 'readonly');
					$btn.addClass('hide');
				}
				return ok;
			});

			$('#btn_upload_fw').click(function() {
		    var formData = new FormData($('#frm_fw')[0]);
		    $.ajax({
	        url: '/update',  
	        type: 'POST',
	        data: formData,
	        cache: false,
	        contentType: false,
	        processData: false,
	        xhr: function() {  
            var myXhr = $.ajaxSettings.xhr();
            if(myXhr.upload)
              myXhr.upload.addEventListener('progress',progressUpdate, false); 
            return myXhr;
	        },
	        beforeSend: function () { 
 						$('#pgfw').removeClass('hide');
	        },
					success: function(msg, textStatus, xhr) {	
						Notify(2, 'floppy-saved', 'success','Envoi de la mise à jour terminé', '<strong>'+xhr.status+'</strong> '+msg); 
						waitReboot();
					},
					error: function(xhr, textStatus, errorThrown) {
 						$('#pfw').removeClass('progress-bar-success').addClass('progress-bar-danger');
						Notify(4, 'floppy-remove', 'danger', 'Erreur lors de la mise à jour du fichier '+name,'<strong>'+xhr.status+'</strong> '+errorThrown);
					}
		    });
			});

			window.onload = function() {  
				var url = document.location.toString();  
   			var full = location.protocol+'//'+location.hostname+(location.port ? ':'+location.port: '');
				console.log (url);
				console.log (full);
				console.log (location.port);
				
				if (url.match('#')) {  
					$('.nav-tabs a[href=#' + url.split('#')[1] + ']').tab('show');  
				}  
	
				$('.nav-tabs a[href=#' + url.split('#')[1] + ']').on('shown', function(e) {  
					window.location.hash = e.target.hash;  
				});   
			}  

			$('#btn_test').click(function(){ waitReboot(); });
			
			$( document ).ready(function() {
		    console.log( "ready!" );
		    $('#tab_tinfo_data').bootstrapTable('refresh',{silent:true, url:'/tinfo.json'}); 
		    //setTimeout(function(){$('#tab_tinfo_data').bootstrapTable('refresh',{silent: true}); console.log( "1st refresh done!" );},1000)
			});
			 
		</script>
	</body>
</html>

